<app-nav-header
  [title]="'Detalhe do √Ålbum'"
  (navigatePrivate)="irParaPrivado()"
  (navigateGroup)="irParaColetivo()"
  (cancel)="cancelar()"
  (back)="voltar()"
></app-nav-header>
<div class="background-slideshow">
  <div class="slide" style="background-image: url('assets/futuristic-background.jpg');"></div>
  <div class="slide" style="background-image: url('assets/futuristic-background2.jpg');"></div>
  <div class="slide" style="background-image: url('assets/futuristic-background3.jpg');"></div>
</div>

<div class="p-4 md:p-8 lg:p-12 max-w-7xl mx-auto">
  <div *ngIf="loading" class="text-center text-lg font-semibold">
    <p>Loading album...</p>
  </div>

  <div *ngIf="error" class="text-center text-red-500 text-lg font-semibold">
    <p>{{ error }}</p>
    <button class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors" (click)="goBack()">Back to Albums</button>
  </div>

  <div *ngIf="!loading && !error && album" class="mt-8">
    <!-- Album Header -->
    <header class="flex flex-col md:flex-row justify-between items-center mb-8 p-4 bg-white shadow-md rounded-lg">
      <div class="text-left mb-4 md:mb-0">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ album.title }}</h1>
        <p class="text-gray-600 mb-4">{{ album.description }}</p>
        <div class="flex flex-wrap gap-x-4 text-sm text-gray-500">
          <span class="inline-flex items-center">{{ album.type }}</span>
          <span *ngIf="album.location" class="inline-flex items-center">üìç {{ album.location }}</span>
          <span *ngIf="album.eventName" class="inline-flex items-center">üéâ {{ album.eventName }}</span>
        </div>
      </div>
      <div class="flex gap-4">
        <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors" (click)="addPhoto()">Add Photo</button>
        <button class="px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors" (click)="editAlbum()">Edit Album</button>
        <button class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 transition-colors" (click)="goBack()">Back</button>
      </div>
    </header>

    <!-- Photos Grid -->
    <div *ngIf="posts.length > 0; else noPosts" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      <div *ngFor="let post of posts" class="bg-white shadow-md rounded-lg overflow-hidden">
        <div class="relative w-full h-48 bg-gray-100 flex items-center justify-center cursor-pointer overflow-hidden" (click)="openLightbox(post)" title="Ampliar">
          <div class="post-actions">
            <button (click)="editPost(post.id)">Edit</button>
            <button (click)="deletePost(post.id)">Delete</button>
          </div>
          <img *ngIf="post.type === 'PHOTO' && post.mediaUrl" 
               [src]="resolveMediaUrl(post.mediaUrl)" 
               [alt]="post.caption || 'Photo'" 
               class="w-full h-full object-cover">
          <div *ngIf="post.type === 'VIDEO' && post.mediaUrl" class="w-full h-full">
            <iframe *ngIf="isYouTubeVideo(post.mediaUrl); else genericVideo" 
                    [src]="getYouTubeEmbedUrl(post.mediaUrl)" 
                    frameborder="0" 
                    allowfullscreen 
                    class="w-full h-full"></iframe>
            <ng-template #genericVideo>
              <video [src]="resolveMediaUrl(post.mediaUrl)" controls class="w-full h-full"></video>
            </ng-template>
          </div>
        </div>
        <div class="p-4" *ngIf="post.caption">
          <p class="text-gray-800 font-semibold text-sm mb-1">{{ post.caption }}</p>
          <p class="text-gray-500 text-xs">{{ post.createdAt | date:'medium' }}</p>
        </div>
      </div>
    </div>

    <ng-template #noPosts>
      <div class="text-center p-8 bg-white shadow-md rounded-lg">
        <h3 class="text-xl font-bold text-gray-800 mb-2">No photos in this album yet</h3>
        <p class="text-gray-600 mb-4">Start adding some memories!</p>
        <button class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors" (click)="addPhoto()">Add First Photo</button>
      </div>
    </ng-template>
  </div>
</div>

<!-- Lightbox overlay -->
<div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" *ngIf="lightboxOpen" (click)="closeLightbox()">
  <div class="relative bg-white p-4 rounded-lg max-w-3xl max-h-full overflow-auto" (click)="$event.stopPropagation()">
    <button class="absolute top-2 right-2 text-gray-800 text-3xl font-bold cursor-pointer" (click)="closeLightbox()">√ó</button>
    <img *ngIf="lightboxType === 'PHOTO'" [src]="resolveMediaUrl(lightboxUrl)" alt="Zoom" class="max-w-full max-h-full object-contain">
    <video *ngIf="lightboxType === 'VIDEO' && !isYouTubeVideo(lightboxUrl)" [src]="resolveMediaUrl(lightboxUrl)" controls class="max-w-full max-h-full object-contain"></video>
    <iframe *ngIf="lightboxType === 'VIDEO' && isYouTubeVideo(lightboxUrl)" [src]="getYouTubeEmbedUrl(lightboxUrl)" frameborder="0" allowfullscreen class="max-w-full max-h-full object-contain"></iframe>
  </div>
</div>